package mitll.langtest.server.database;import com.google.gwt.util.tools.shared.Md5Utils;import mitll.langtest.client.user.Md5Hash;import java.io.BufferedReader;import java.io.File;import java.io.FileInputStream;import java.io.IOException;import java.io.InputStreamReader;import java.io.OutputStream;import java.net.HttpURLConnection;import java.net.URL;/** * This program demonstrates how to upload files to a web server * using HTTP POST request without any HTML form. * * @author www.codejava.net */public class FileUploader {  static final String UPLOAD_URL = "http://127.0.0.1:8888/scoreServlet";  // static final String UPLOAD_URL = "https://np.ll.mit.edu/npfClassroomEnglish/scoreServlet";  static final int BUFFER_SIZE = 4096;  public static void main(String[] args) throws IOException {    // takes file path from first program's argument/*    testHasUser();    String dave = "bill";    testHasUser(dave, Md5Hash.getHash("bueller"));    testAddUser(dave);    testHasUser(dave, Md5Hash.getHash("bueller"));    testHasUser(dave, Md5Hash.getHash("buellerX"));    testAddUser(dave);*/    testPost2(false);    testPost2(true);  }  private static void testHasUser() throws IOException {    String gvidaver = "gvidaver";//"gvidaver";    String pass = "8479166e9d8fd7abf3e41a1bfebfb0b7";    testHasUser(gvidaver, pass);  }  private static void testHasUser(String gvidaver, String pass) throws IOException {    URL url = new URL(UPLOAD_URL + "?hasUser=" +        gvidaver+"&passH=" +        pass.toUpperCase()    );    HttpURLConnection httpConn = (HttpURLConnection) url.openConnection();    httpConn.setRequestMethod("GET");    //  httpConn.setRequestProperty("hasUser", "gvidaver");    // always check HTTP response code from server    getResponse(httpConn);  }  private static void testAddUser(String name) throws IOException {  //  String gvidaver = "defectDetector";//"gvidaver";    URL url = new URL(UPLOAD_URL);// + "?addUser=" +        //gvidaver);    HttpURLConnection httpConn = (HttpURLConnection) url.openConnection();    httpConn.setRequestMethod("POST");    httpConn.setRequestProperty("request", "addUser");    httpConn.setRequestProperty("user", name);    httpConn.setRequestProperty("device", "1234567890ABCDEFGHIJ");    httpConn.setRequestProperty("deviceType", "iPad");    httpConn.setRequestProperty("passwordH", Md5Hash.getHash("bueller"));    httpConn.setRequestProperty("emailH", Md5Hash.getHash("dave@dave.com"));    // always check HTTP response code from server    getResponse(httpConn);  }  private static void testPost2(boolean decode) throws IOException {    //String filePath = "/Users/go22670/netPron2/war/config/english/bestAudio/Fast.wav";//args[0];    String filePath = "/Users/go22670/netPron2/war/config/msa/bestAudio/2549/Fast.wav";    File uploadFile = new File(filePath);    System.out.println("File to upload: " + filePath);    // creates a HTTP connection    HttpURLConnection httpConn = getPost();    // sets file name as a HTTP header    httpConn.setRequestProperty("fileName", uploadFile.getName());    httpConn.setRequestProperty("user", "1");    httpConn.setRequestProperty("deviceType", "iPad");    httpConn.setRequestProperty("device", "01234567890");    httpConn.setRequestProperty("exercise", ""+2549);    httpConn.setRequestProperty("request", decode ? "decode" :"align");    postFile(uploadFile, httpConn);    // always check HTTP response code from server    getResponse(httpConn);  }  private static void testPost() throws IOException {    String filePath = "/Users/go22670/netPron2/war/config/english/bestAudio/Fast.wav";//args[0];    File uploadFile = new File(filePath);    System.out.println("File to upload: " + filePath);    // creates a HTTP connection    HttpURLConnection httpConn = getPost();    // sets file name as a HTTP header    httpConn.setRequestProperty("fileName", uploadFile.getName());    httpConn.setRequestProperty("word", "book");    httpConn.setRequestProperty("flashcard", "flashcard");    postFile(uploadFile, httpConn);    // always check HTTP response code from server    getResponse(httpConn);  }  private static HttpURLConnection getPost() throws IOException {    URL url = new URL(UPLOAD_URL);    HttpURLConnection httpConn = (HttpURLConnection) url.openConnection();    httpConn.setUseCaches(false);    httpConn.setDoOutput(true);    httpConn.setRequestMethod("POST");    return httpConn;  }  private static void getResponse(HttpURLConnection httpConn) throws IOException {    int responseCode = httpConn.getResponseCode();    if (responseCode == HttpURLConnection.HTTP_OK) {      // reads server's response      BufferedReader reader = new BufferedReader(new InputStreamReader(        httpConn.getInputStream()));      String response = reader.readLine();      System.out.println("Server's response: " + response);    } else {      System.out.println("Server returned non-OK code: " + responseCode);    }  }  private static void postFile(File uploadFile, HttpURLConnection httpConn) throws IOException {    // opens output stream of the HTTP connection for writing data    OutputStream outputStream = httpConn.getOutputStream();    // Opens input stream of the file for reading data    FileInputStream inputStream = new FileInputStream(uploadFile);    byte[] buffer = new byte[BUFFER_SIZE];    int bytesRead = -1;    System.out.println("Start writing data...");    while ((bytesRead = inputStream.read(buffer)) != -1) {      outputStream.write(buffer, 0, bytesRead);    }    System.out.println("Data was written.");    outputStream.close();    inputStream.close();  }}